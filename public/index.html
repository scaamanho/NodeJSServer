<html>
<head>
  <title>INplan Web Sockets Monitor</title>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>

  <script>
    var connected = false;
    var socket;

    function connect() {
      if (connected) {
        socket.disconnect();
        $("#btConnect").addClass("btn btn-warning");
        $("#btConnect").prop('value', 'Disabled');
        $("#btConnect").prop("disabled", true);

        $("#lastUpdatedTime").removeClass("form-control");
        $("#lastUpdatedTime").addClass("btn btn-danger");
        $("#lastUpdatedTime").prop('value', 'Disconnected');
        connected = false;
      } else {
        createShocket();
        $("#btConnect").addClass("btn btn-danger");
        $("#btConnect").prop('value', 'Disconnect');

        $("#lastUpdatedTime").removeClass("btn btn-danger");
        $("#lastUpdatedTime").addClass("form-control");
        $("#lastUpdatedTime").prop('value', new Date().toLocaleTimeString());
        connected = true;
      }
    }

    function createShocket() {
      url = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '');
      group = $("#stakeholder").val();
      socket = io.connect(url, {
        query: "useName=" + userName;
      });
      socket.on('chatUpdate', chatUpdate);

      /*Sample Test*/
      socket.emit('chatUpdate', 'update chat');
      socket.emit('chatGlobalUpdate', 'update global chat');
      socket.emit('chatUpdate', 'update chat 2');
      socket.emit('chatGlobalUpdate', 'update global chat 2');
    }

    //Listener de eventos web sockets

    chatUpdate = function (content) {
      console.log('chatUpdate:' + content)
      updateWidget("cu", cuMsg++);
      messageContainer.chatUpdate = content;
    }

    function updateWidget(widget, numMessages) {
      dateString = new Date().toLocaleTimeString();
      $("#" + widget + "Messages").text(numMessages);
      $("#" + widget + "Timestamp").text(dateString);
      $("#lastUpdatedTime").prop('value', dateString);
      if (numMessages === 1) {
        $("#" + widget + "Btn").removeClass('btn-primary');
        $("#" + widget + "Btn").addClass('btn-success');
      }
    }
  </script>
</head>

<body >
  <div class="container">
  <div class="jumbotron">
    <h1>My first Bootstrap website!</h1>
    <p>This page will grow as we add more and more components from Bootstrap...</p>
  </div>
  <p>This is a paragraph.</p>
  <p>This is another paragraph.</p>
  <p>This is a paragraph.</p>
  <p>This is another paragraph.</p>
</div>
</html>
